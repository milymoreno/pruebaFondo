{"ast":null,"code":"import * as i0 from \"@angular/core\";\nimport * as i1 from \"../services/product.service\";\nimport * as i2 from \"@angular/common\";\nimport * as i3 from \"@angular/forms\";\nfunction ProductsComponent_div_14_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\");\n    i0.ɵɵelement(1, \"img\", 9);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const previewUrl_r3 = ctx.$implicit;\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"src\", previewUrl_r3, i0.ɵɵsanitizeUrl);\n  }\n}\nfunction ProductsComponent_ng_container_36_div_14_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 13);\n    i0.ɵɵelement(1, \"img\", 14);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const image_r6 = ctx.$implicit;\n    const ctx_r5 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"src\", ctx_r5.replacePublicWithStorage(image_r6.path), i0.ɵɵsanitizeUrl);\n  }\n}\nfunction ProductsComponent_ng_container_36_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r8 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementContainerStart(0);\n    i0.ɵɵelementStart(1, \"tr\")(2, \"td\");\n    i0.ɵɵtext(3);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(4, \"td\");\n    i0.ɵɵtext(5);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(6, \"td\");\n    i0.ɵɵtext(7);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(8, \"td\");\n    i0.ɵɵtext(9);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(10, \"td\");\n    i0.ɵɵtext(11);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(12, \"td\")(13, \"div\", 10);\n    i0.ɵɵtemplate(14, ProductsComponent_ng_container_36_div_14_Template, 2, 1, \"div\", 11);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(15, \"td\")(16, \"button\", 12);\n    i0.ɵɵlistener(\"click\", function ProductsComponent_ng_container_36_Template_button_click_16_listener() {\n      const restoredCtx = i0.ɵɵrestoreView(_r8);\n      const product_r4 = restoredCtx.$implicit;\n      const ctx_r7 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r7.selectProduct(product_r4));\n    });\n    i0.ɵɵtext(17, \"Edit\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(18, \"button\", 12);\n    i0.ɵɵlistener(\"click\", function ProductsComponent_ng_container_36_Template_button_click_18_listener() {\n      const restoredCtx = i0.ɵɵrestoreView(_r8);\n      const product_r4 = restoredCtx.$implicit;\n      const ctx_r9 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r9.deleteProduct(product_r4.id));\n    });\n    i0.ɵɵtext(19, \"Delete\");\n    i0.ɵɵelementEnd()()();\n    i0.ɵɵelementContainerEnd();\n  }\n  if (rf & 2) {\n    const product_r4 = ctx.$implicit;\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate(product_r4.id);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(product_r4.name);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(product_r4.description);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(product_r4.price);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(product_r4.quantity);\n    i0.ɵɵadvance(3);\n    i0.ɵɵproperty(\"ngForOf\", product_r4.images);\n  }\n}\nfunction ProductsComponent_div_37_div_13_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\");\n    i0.ɵɵelement(1, \"img\", 17);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const i_r12 = ctx.index;\n    const ctx_r10 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"src\", ctx_r10.selectedImagePreviews[i_r12], i0.ɵɵsanitizeUrl);\n  }\n}\nfunction ProductsComponent_div_37_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r14 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\")(1, \"h3\");\n    i0.ɵɵtext(2, \"Edit Product\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"form\", 0);\n    i0.ɵɵlistener(\"submit\", function ProductsComponent_div_37_Template_form_submit_3_listener() {\n      i0.ɵɵrestoreView(_r14);\n      const ctx_r13 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r13.updateProduct());\n    });\n    i0.ɵɵelementStart(4, \"input\", 1);\n    i0.ɵɵlistener(\"ngModelChange\", function ProductsComponent_div_37_Template_input_ngModelChange_4_listener($event) {\n      i0.ɵɵrestoreView(_r14);\n      const ctx_r15 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r15.selectedProduct.name = $event);\n    });\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(5, \"input\", 2);\n    i0.ɵɵlistener(\"ngModelChange\", function ProductsComponent_div_37_Template_input_ngModelChange_5_listener($event) {\n      i0.ɵɵrestoreView(_r14);\n      const ctx_r16 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r16.selectedProduct.description = $event);\n    });\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(6, \"input\", 3);\n    i0.ɵɵlistener(\"ngModelChange\", function ProductsComponent_div_37_Template_input_ngModelChange_6_listener($event) {\n      i0.ɵɵrestoreView(_r14);\n      const ctx_r17 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r17.selectedProduct.price = $event);\n    });\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(7, \"input\", 4);\n    i0.ɵɵlistener(\"ngModelChange\", function ProductsComponent_div_37_Template_input_ngModelChange_7_listener($event) {\n      i0.ɵɵrestoreView(_r14);\n      const ctx_r18 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r18.selectedProduct.quantity = $event);\n    });\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(8, \"input\", 15);\n    i0.ɵɵlistener(\"change\", function ProductsComponent_div_37_Template_input_change_8_listener($event) {\n      i0.ɵɵrestoreView(_r14);\n      const ctx_r19 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r19.onFilesSelected($event));\n    });\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(9, \"button\", 6);\n    i0.ɵɵtext(10, \"Update Product\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(11, \"button\", 16);\n    i0.ɵɵlistener(\"click\", function ProductsComponent_div_37_Template_button_click_11_listener() {\n      i0.ɵɵrestoreView(_r14);\n      const ctx_r20 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r20.cancelEdit());\n    });\n    i0.ɵɵtext(12, \"Cancel\");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵtemplate(13, ProductsComponent_div_37_div_13_Template, 2, 1, \"div\", 7);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r2 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(4);\n    i0.ɵɵproperty(\"ngModel\", ctx_r2.selectedProduct.name);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngModel\", ctx_r2.selectedProduct.description);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngModel\", ctx_r2.selectedProduct.price);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngModel\", ctx_r2.selectedProduct.quantity);\n    i0.ɵɵadvance(6);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r2.selectedProduct.images);\n  }\n}\nexport let ProductsComponent = /*#__PURE__*/(() => {\n  class ProductsComponent {\n    constructor(productService) {\n      this.productService = productService;\n      this.products = [];\n      this.newProduct = {\n        id: 0,\n        name: '',\n        description: '',\n        price: 0,\n        quantity: 0,\n        images: [],\n        created_at: new Date(),\n        updated_at: new Date()\n      };\n      this.selectedProduct = null;\n      this.selectedImage = null;\n      this.selectedImagePreviews = [];\n      this.selectedFiles = [];\n    }\n    ngOnInit() {\n      this.loadProducts();\n    }\n    loadProducts() {\n      this.productService.getProducts().subscribe(products => {\n        console.error('Lista de productos:', products);\n        this.products = products;\n      });\n    }\n    /*addProduct(): void {\r\n      const images: Image[] = [];\r\n      this.productService.createProduct(this.newProduct).subscribe(product => {\r\n        product.images = images;\r\n        console.log(this.newProduct);\r\n        console.log(JSON.stringify(this.newProduct, null, 2));\r\n        this.products.push(product);\r\n        this.resetNewProduct();\r\n        \r\n      });\r\n    }*/\n    addProduct() {\n      const formData = new FormData();\n      // Agregar los datos del producto al FormData\n      formData.append('name', this.newProduct.name);\n      formData.append('description', this.newProduct.description);\n      formData.append('price', this.newProduct.price.toString());\n      formData.append('quantity', this.newProduct.quantity.toString());\n      // Agregar las imágenes al FormData\n      for (let i = 0; i < this.selectedFiles.length; i++) {\n        formData.append('images[]', this.selectedFiles[i]);\n      }\n      this.productService.createProduct(formData).subscribe(response => {\n        console.log(response);\n        this.products.push(response);\n        this.resetNewProduct();\n      }, error => {\n        console.error('Error al agregar el producto:', error);\n      });\n    }\n    /*updateProduct(): void {\r\n      if (this.selectedProduct) {\r\n        this.productService.updateProduct(this.selectedProduct).subscribe(updatedProduct => {\r\n          const index = this.products.findIndex(p => p.id === updatedProduct.id);\r\n          if (index !== -1) {\r\n            this.products[index] = updatedProduct;\r\n          }\r\n          this.selectedProduct = null;\r\n        });\r\n      }\r\n    }*/\n    updateProduct() {\n      if (!this.selectedProduct) {\n        return;\n      }\n      const formData = new FormData();\n      formData.append('id', this.selectedProduct.id.toString());\n      formData.append('name', this.selectedProduct.name);\n      formData.append('description', this.selectedProduct.description);\n      formData.append('price', this.selectedProduct.price.toString());\n      formData.append('quantity', this.selectedProduct.quantity.toString());\n      for (let i = 0; i < this.selectedFiles.length; i++) {\n        formData.append('images[]', this.selectedFiles[i]);\n      }\n      this.productService.updateProduct(this.selectedProduct.id, formData).subscribe(response => {\n        const index = this.products.findIndex(p => p.id === this.selectedProduct.id);\n        this.products[index] = response;\n        this.resetNewProduct();\n      }, error => {\n        console.error('Error al actualizar el producto:', error);\n      });\n      //this.selectedProduct = null;\n      //this.clearForm();\n    }\n\n    clearForm() {\n      // Limpiar los campos del formulario\n      this.selectedProduct = {\n        id: 0,\n        name: '',\n        description: '',\n        price: 0,\n        quantity: 0,\n        images: [],\n        created_at: new Date(),\n        updated_at: new Date()\n      };\n    }\n    deleteProduct(productId) {\n      this.productService.deleteProduct(productId).subscribe(() => {\n        this.products = this.products.filter(p => p.id !== productId);\n      });\n    }\n    selectProduct(product) {\n      this.selectedProduct = {\n        ...product\n      };\n      this.selectedImagePreviews = product.images.map(image => this.replacePublicWithStorage(image.path));\n    }\n    deleteImage(image) {\n      if (!this.selectedProduct) {\n        return;\n      }\n      this.productService.deleteImage(this.selectedProduct.id, image.id).subscribe(() => {\n        const index = this.selectedProduct.images.findIndex(img => img.id === image.id);\n        if (index !== -1) {\n          this.selectedProduct.images.splice(index, 1);\n          this.selectedImagePreviews.splice(index, 1);\n        }\n      }, error => {\n        console.error('Error al eliminar la imagen:', error);\n      });\n    }\n    resetNewProduct() {\n      this.newProduct = {\n        id: 0,\n        name: '',\n        description: '',\n        price: 0,\n        quantity: 0,\n        images: [],\n        created_at: new Date(),\n        updated_at: new Date()\n      };\n      this.selectedFiles = [];\n      this.selectedImagePreviews = [];\n      // Opcional: Restablece el input de archivo\n      const fileInput = document.getElementById('fileInput');\n      if (fileInput) {\n        fileInput.value = '';\n      }\n    }\n    addImage(path) {\n      const image = {\n        id: 0,\n        path,\n        product_id: this.selectedProduct ? this.selectedProduct.id : this.newProduct.id,\n        created_at: new Date(),\n        updated_at: new Date()\n      };\n      if (this.selectedProduct) {\n        this.selectedProduct.images.push(image);\n      } else {\n        this.newProduct.images.push(image);\n      }\n    }\n    removeImage(index) {\n      if (this.selectedProduct) {\n        this.selectedProduct.images.splice(index, 1);\n      } else {\n        this.newProduct.images.splice(index, 1);\n      }\n    }\n    // Función para reemplazar 'public' por 'storage' en las rutas de las imágenes\n    replacePublicWithStorage(imagePath) {\n      return imagePath.replace('public', 'http://localhost:8000/storage');\n    }\n    onFileSelected(event) {\n      const file = event.target.files[0];\n      if (file) {\n        const reader = new FileReader();\n        reader.onload = () => {\n          this.selectedImage = reader.result;\n        };\n        reader.readAsDataURL(file);\n      }\n    }\n    onFilesSelected(event) {\n      const files = event.target.files;\n      if (files) {\n        this.selectedFiles = [];\n        this.selectedImagePreviews = [];\n        for (let i = 0; i < files.length; i++) {\n          this.selectedFiles.push(files[i]);\n          const imageUrl = URL.createObjectURL(files[i]);\n          this.selectedImagePreviews.push(imageUrl);\n        }\n      }\n    }\n    cancelEdit() {\n      this.selectedProduct = null; // Establece selectedProduct en null para cerrar el formulario de edición\n    }\n    static #_ = this.ɵfac = function ProductsComponent_Factory(t) {\n      return new (t || ProductsComponent)(i0.ɵɵdirectiveInject(i1.ProductService));\n    };\n    static #_2 = this.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n      type: ProductsComponent,\n      selectors: [[\"app-products\"]],\n      decls: 38,\n      vars: 7,\n      consts: [[3, \"submit\"], [\"type\", \"text\", \"name\", \"name\", \"placeholder\", \"Name\", \"required\", \"\", 3, \"ngModel\", \"ngModelChange\"], [\"type\", \"text\", \"name\", \"description\", \"placeholder\", \"Description\", \"required\", \"\", 3, \"ngModel\", \"ngModelChange\"], [\"type\", \"number\", \"name\", \"price\", \"placeholder\", \"Price\", \"required\", \"\", 3, \"ngModel\", \"ngModelChange\"], [\"type\", \"number\", \"name\", \"quantity\", \"placeholder\", \"Quantity\", \"required\", \"\", 3, \"ngModel\", \"ngModelChange\"], [\"type\", \"file\", \"multiple\", \"\", 3, \"change\"], [\"type\", \"submit\"], [4, \"ngFor\", \"ngForOf\"], [4, \"ngIf\"], [\"alt\", \"Vista previa de la imagen\", 2, \"max-width\", \"100px\", \"max-height\", \"100px\", 3, \"src\"], [1, \"image-container\"], [\"class\", \"image-wrapper\", 4, \"ngFor\", \"ngForOf\"], [3, \"click\"], [1, \"image-wrapper\"], [\"alt\", \"Mi imagen\", \"width\", \"100\", \"height\", \"100\", 3, \"src\"], [\"type\", \"file\", \"id\", \"fileInputUpdate\", \"multiple\", \"\", 3, \"change\"], [\"type\", \"button\", 3, \"click\"], [\"alt\", \"Producto existente\", 2, \"max-width\", \"100px\", \"max-height\", \"100px\", 3, \"src\"]],\n      template: function ProductsComponent_Template(rf, ctx) {\n        if (rf & 1) {\n          i0.ɵɵelementStart(0, \"div\")(1, \"h3\");\n          i0.ɵɵtext(2, \"Product Management\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(3, \"div\")(4, \"h4\");\n          i0.ɵɵtext(5, \"Add New Product\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(6, \"form\", 0);\n          i0.ɵɵlistener(\"submit\", function ProductsComponent_Template_form_submit_6_listener() {\n            return ctx.addProduct();\n          });\n          i0.ɵɵelementStart(7, \"input\", 1);\n          i0.ɵɵlistener(\"ngModelChange\", function ProductsComponent_Template_input_ngModelChange_7_listener($event) {\n            return ctx.newProduct.name = $event;\n          });\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(8, \"input\", 2);\n          i0.ɵɵlistener(\"ngModelChange\", function ProductsComponent_Template_input_ngModelChange_8_listener($event) {\n            return ctx.newProduct.description = $event;\n          });\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(9, \"input\", 3);\n          i0.ɵɵlistener(\"ngModelChange\", function ProductsComponent_Template_input_ngModelChange_9_listener($event) {\n            return ctx.newProduct.price = $event;\n          });\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(10, \"input\", 4);\n          i0.ɵɵlistener(\"ngModelChange\", function ProductsComponent_Template_input_ngModelChange_10_listener($event) {\n            return ctx.newProduct.quantity = $event;\n          });\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(11, \"input\", 5);\n          i0.ɵɵlistener(\"change\", function ProductsComponent_Template_input_change_11_listener($event) {\n            return ctx.onFilesSelected($event);\n          });\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(12, \"button\", 6);\n          i0.ɵɵtext(13, \"Add Product\");\n          i0.ɵɵelementEnd()();\n          i0.ɵɵtemplate(14, ProductsComponent_div_14_Template, 2, 1, \"div\", 7);\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(15, \"div\")(16, \"h4\");\n          i0.ɵɵtext(17, \"Product List\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(18, \"table\")(19, \"thead\")(20, \"tr\")(21, \"th\");\n          i0.ɵɵtext(22, \"ID\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(23, \"th\");\n          i0.ɵɵtext(24, \"Name\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(25, \"th\");\n          i0.ɵɵtext(26, \"Description\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(27, \"th\");\n          i0.ɵɵtext(28, \"Price\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(29, \"th\");\n          i0.ɵɵtext(30, \"Quantity\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(31, \"th\");\n          i0.ɵɵtext(32, \"Images\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(33, \"th\");\n          i0.ɵɵtext(34, \"Actions\");\n          i0.ɵɵelementEnd()()();\n          i0.ɵɵelementStart(35, \"tbody\");\n          i0.ɵɵtemplate(36, ProductsComponent_ng_container_36_Template, 20, 6, \"ng-container\", 7);\n          i0.ɵɵelementEnd()()();\n          i0.ɵɵtemplate(37, ProductsComponent_div_37_Template, 14, 5, \"div\", 8);\n          i0.ɵɵelementEnd();\n        }\n        if (rf & 2) {\n          i0.ɵɵadvance(7);\n          i0.ɵɵproperty(\"ngModel\", ctx.newProduct.name);\n          i0.ɵɵadvance(1);\n          i0.ɵɵproperty(\"ngModel\", ctx.newProduct.description);\n          i0.ɵɵadvance(1);\n          i0.ɵɵproperty(\"ngModel\", ctx.newProduct.price);\n          i0.ɵɵadvance(1);\n          i0.ɵɵproperty(\"ngModel\", ctx.newProduct.quantity);\n          i0.ɵɵadvance(4);\n          i0.ɵɵproperty(\"ngForOf\", ctx.selectedImagePreviews);\n          i0.ɵɵadvance(22);\n          i0.ɵɵproperty(\"ngForOf\", ctx.products);\n          i0.ɵɵadvance(1);\n          i0.ɵɵproperty(\"ngIf\", ctx.selectedProduct);\n        }\n      },\n      dependencies: [i2.NgForOf, i2.NgIf, i3.ɵNgNoValidate, i3.DefaultValueAccessor, i3.NumberValueAccessor, i3.NgControlStatus, i3.NgControlStatusGroup, i3.RequiredValidator, i3.NgModel, i3.NgForm],\n      styles: [\".image-container[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100px;height:100px}.product-info[_ngcontent-%COMP%]{display:flex;align-items:center}.image-container[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap}.image-wrapper[_ngcontent-%COMP%], .image-preview[_ngcontent-%COMP%]{margin-right:10px}.product-item[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{flex:1;padding:5px}.product-item[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;margin-bottom:10px;border-bottom:1px solid #ccc}.button-container[_ngcontent-%COMP%]{display:flex;align-items:center}th[_ngcontent-%COMP%], td[_ngcontent-%COMP%]{border:1px solid black;padding:8px}\"]\n    });\n  }\n  return ProductsComponent;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}